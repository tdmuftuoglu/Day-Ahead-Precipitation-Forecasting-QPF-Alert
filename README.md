# Day-Ahead Precipitation Forecasting: QPF + Alert
## Gün-Öncesi Yağış Tahmini: QPF + Uyarı

[![Open In Colab](https://colab.research.google.com/assets/colab-badge.svg)](https://colab.research.google.com/github/tdmuftuoglu/Day-Ahead-Precipitation-Forecasting-QPF-Alert/blob/main/KoycegizPrecipExtended.ipynb)
![Python](https://img.shields.io/badge/Python-3.9%2B-blue.svg)
![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)

This repository provides an explainable **two-stage machine-learning pipeline** for day-ahead precipitation forecasting in **Köyceğiz, Türkiye**, using **NASA POWER** daily meteorology (2001–2024). Stage-1 is a **CatBoost** regressor for quantitative precipitation forecasting (QPF); Stage-2 is a **LightGBM** classifier for extreme-event alerting based on a **95th-percentile** threshold. The pipeline preserves operational causality by using features available only up to *t−1* and reports calibrated performance (e.g., test **R² ≈ 0.837**; classification **F1 ≈ 0.752**; **AUC > 0.97**).

---
Bu repo, **Köyceğiz (Türkiye)** için **NASA POWER** günlük meteorolojisini (2001–2024) kullanarak gün-öncesi yağış tahmini amacıyla açıklanabilir **iki aşamalı bir makine öğrenmesi hattı** sunar. **1. aşama**, nicel yağış tahmini (QPF) için **CatBoost** regresyonudur; **2. aşama**, **%95 persentil** eşiğine göre aşırı-olay uyarıları üreten **LightGBM** sınıflandırıcıdır. İş akışı, yalnızca *t−1* anına kadar erişilebilen özellikleri kullanarak **operasyonel nedenselliği** korur ve kalibre edilmiş performans sunar (örn. test **R² ≈ 0.837**; sınıflandırma **F1 ≈ 0.752**; **AUC > 0.97**).

---

## Features / Projenin Özellikleri

- **High Accuracy / Yüksek Doğruluk:** Matches strong QPF baselines on hold-out tests (**R² ≈ 0.837**). / Ayrılmış testlerde güçlü QPF tabanlarına yetişen doğruluk (**R² ≈ 0.837**).
- **Extreme-Event Alerts / Aşırı-Olay Uyarıları:** Robust detection with **LightGBM** (**F1 ≈ 0.752; AUC > 0.97**). / **LightGBM** ile sağlam tespit (**F1 ≈ 0.752; AUC > 0.97**).
- **Explainability / Açıklanabilirlik:** **SHAP** analyses provide feature attributions and sign consistency. / **SHAP** analizleri özellik katkılarını ve işaret tutarlılığını gösterir.
- **Reproducibility / Tekrarlanabilirlik:** Single **Google Colab** notebook reproduces all figures and tables end-to-end. / Tek bir **Google Colab** not defteri tüm şekil ve tabloları uçtan uca yeniden üretir.

---

## How to Reproduce the Paper / Makale Sonuçlarını Tekrarlama

The entire workflow is automated in a Google Colab notebook.  
Tüm iş akışı, bir Google Colab not defterinde otomatikleştirilmiştir.

1. **Open in Colab:** Click the **"Open in Colab"** badge at the top of this file.  
   **Colab'de Açın:** Bu dosyanın başındaki **"Open in Colab"** butonuna tıklayın.
2. **Run All:** In the Colab interface, navigate to **Runtime → Run all**.  
   **Tümünü Çalıştırın:** Colab arayüzünde **Çalışma Zamanı → Tümünü çalıştır** seçeneğini seçin.
3. **Automatic Execution / Otomatik İşlemler:** The notebook will automatically:  
   Not defteri otomatik olarak şunları yapacaktır:
   - Download & preprocess **NASA POWER** daily meteorology and target precipitation. / **NASA POWER** günlük meteoroloji ve hedef yağış verisini indirip ön işler.
   - Build lag features (**t−1, t−3, t−7**), calendar terms, and rolling statistics. / Gecikmeli özellikler (**t−1, t−3, t−7**), takvim terimleri ve hareketli istatistikleri oluşturur.
   - Train the **CatBoost** QPF regressor. / **CatBoost** QPF regresyonunu eğitir.
   - Train & evaluate the **LightGBM** extreme-event classifier (**95th-percentile** threshold). / **LightGBM** aşırı-olay sınıflandırıcısını (**%95 persentil**) eğitir ve değerlendirir.
   - Calibrate & export metrics (**R², RMSE, F1, AUC**) and diagnostic plots. / **(R², RMSE, F1, AUC)** metriklerini ve tanı grafikleri kalibre edip dışa aktarır.
   - Generate **SHAP** explanations and export all figures. / **SHAP** açıklamalarını üretir ve tüm görselleri dışa aktarır.

---

## Repository Contents / Repo İçeriği

- `KoycegizPrecipExtended.ipynb` → One-click **Colab** notebook (end-to-end pipeline). / Uçtan uca tüm adımları içeren tek tıkla çalışan **Colab** not defteri.
- Regression / classification metric tables. / Regresyon / sınıflandırma metrik tabloları.
- Key performance metrics and calibration details. / Temel performans metrikleri ve kalibrasyon ayrıntıları.
- Figures generated by the pipeline. / Kod tarafından oluşturulan görseller.
- `LICENSE` → MIT License file. / MIT Lisans dosyası.

---

## Citation / Atıf

If you use this repository in your research, please cite:  
Bu repoyu araştırmalarınızda kullanırsanız, lütfen atıfta bulunun:

Muftuoglu, T. D. (2025). *High-Accuracy Day-Ahead Precipitation Forecasting with an Interpretable CatBoost Regressor and a LightGBM-Based Extreme-Event Alerting Pipeline *. GitHub. https://github.com/tdmuftuoglu/Day-Ahead-Precipitation-Forecasting-QPF-Alert

---

## License / Lisans

This project is licensed under the **MIT License**. See the [`LICENSE`](LICENSE) file for full terms.  
Bu proje **MIT Lisansı** altında lisanslanmıştır. Tüm koşullar için [`LICENSE`](LICENSE) dosyasına bakın.
